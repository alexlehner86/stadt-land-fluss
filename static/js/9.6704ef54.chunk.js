(this["webpackJsonpstadt-land-fluss"]=this["webpackJsonpstadt-land-fluss"]||[]).push([[9],{161:function(e,t,a){"use strict";a.d(t,"k",(function(){return c})),a.d(t,"j",(function(){return d})),a.d(t,"g",(function(){return m})),a.d(t,"m",(function(){return p})),a.d(t,"e",(function(){return f})),a.d(t,"d",(function(){return h})),a.d(t,"c",(function(){return g})),a.d(t,"h",(function(){return b})),a.d(t,"i",(function(){return E})),a.d(t,"l",(function(){return P})),a.d(t,"a",(function(){return O})),a.d(t,"b",(function(){return C})),a.d(t,"f",(function(){return R}));var n=a(22),r=a(162),i=a(169),o=a(181),s=a.n(o),l=a(63),u=a(43),c=function(e,t){if(e>t.length)throw new Error("Cannot create more randomn unique letters than the number of possibleLetters provided!");for(var a=[],n=Object(r.a)(t),i=function(e){var t=s()(n);a.push(t),n=n.filter((function(e){return e!==t}))},o=0;o<e;o++)i();return a},d=function(e){return Array.from(e).map((function(e){return e[1]})).sort((function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0}))},m=function(e){return Object(u.e)(e,{points:l.s,star:!1,text:"",valid:!0})},p=function(e){return e.map((function(e){return Object(n.a)({},e,{text:e.text.trim(),valid:!!e.text})}))},f=function(e,t){var a=new Map;return e.forEach((function(n){var r=[];t.forEach((function(t){var a=new Map;e.forEach((function(e){a.set(e.id,!0)})),r.push(a)})),a.set(n.id,r)})),a},h=function(e,t){if(e.checkForDuplicates||e.onlyPlayerWithValidAnswer)for(var a=t.keys().next().value,n=t.get(a),r=0;r<n.length;r++)g(e,t,r)},g=function(e,t,a){(e.checkForDuplicates||e.onlyPlayerWithValidAnswer)&&Array.from(t.keys()).forEach((function(n){var r=t.get(n);r[a].valid&&(e.onlyPlayerWithValidAnswer&&v(n,t,a)?r[a].points=l.n:e.checkForDuplicates&&y(n,t,a)?r[a].points=l.o:r[a].points=l.s)}))},v=function(e,t,a){var n=Array.from(t.keys()).filter((function(t){return t!==e})),r=!0;return n.forEach((function(e){return r=r&&!t.get(e)[a].valid})),r},y=function(e,t,a){var n=Array.from(t.keys()).filter((function(t){return t!==e})),r=t.get(e)[a].text.toLowerCase().replace(/[^0-9a-z]/gi,"");return Object(i.some)(n,(function(e){var n=t.get(e)[a];return n.valid&&r===n.text.toLowerCase().replace(/[^0-9a-z]/gi,"")}))},b=function(e){return e<=3?1:2},E=function(e){var t=0;return e.forEach((function(e){return t=e?t:t+1})),t},P=function(e,t){var a=new Map;return e.forEach((function(e,n){if(!e){var r=t.get(n);r&&a.set(n,r)}})),d(a)},O=function(e,t){t.forEach((function(t){t.forEach((function(t){t.valid?e.creativeAnswersExtraPoints&&t.star&&(t.points=t.points+l.d):t.points=0}))}))},C=function(e,t){var a=[],n={};return e.forEach((function(e,t){return n[t]={playerName:e.name,points:0}})),t.forEach((function(e){e.forEach((function(e,t){var a=e.reduce((function(e,t){return e+t.points}),0);n[t].points+=a}))})),Object.keys(n).forEach((function(e){return a.push(n[e])})),a.sort((function(e,t){return t.points-e.points}))},R=function(e,t,a){var n=[];return a.forEach((function(a){a.forEach((function(a,r){var i=e.get(r);a.forEach((function(e,a){e.valid&&e.star&&n.push({category:t.categories[a],playerName:i.name,text:e.text})}))}))})),n}},182:function(e,t,a){"use strict";var n=a(0),r=a.n(n),i=a(63);t.a=function(e){var t=e.rules;return t.checkForDuplicates||t.onlyPlayerWithValidAnswer||t.creativeAnswersExtraPoints?r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"bold-text"},"Regeln f\xfcr die Punktevergabe:"),r.a.createElement("ul",null,t.checkForDuplicates?r.a.createElement("li",null,i.e.checkForDuplicates):null,t.onlyPlayerWithValidAnswer?r.a.createElement("li",null,i.e.onlyPlayerWithValidAnswer):null,t.creativeAnswersExtraPoints?r.a.createElement("li",null,i.e.creativeAnswersExtraPoints):null)):null}},219:function(e,t,a){},220:function(e,t,a){},228:function(e,t,a){},229:function(e,t,a){e.exports={link_label:"JoinGameLink_link_label__1tx1j"}},231:function(e){e.exports=JSON.parse('{"publishKey":"pub-c-cea13e04-e3aa-434b-806f-fc890fbd45bf","subscribeKey":"sub-c-66cfccd4-6c89-11ea-a7c4-5e95b827fd71"}')},279:function(e,t,a){"use strict";a.r(t);var n,r=a(22),i=a(162),o=a(32),s=a(33),l=a(35),u=a(36),c=a(169),d=a(212),m=a.n(d),p=a(192),f=a(0),h=a.n(f),g=a(20),v=a(170),y=a(286),b=a(260),E=a(261),P=a(262),O=a(186),C=a(147),R=a(130),w=a(156),j=a(216),k=a(218),I=a(117),x=a(217),A=a.n(x),N=a(177),S=a.n(N),F=a(161),M=Object(I.a)({adminPanel:{position:"absolute",top:"1rem",right:"1rem"},menuButton:{background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,255,255,0.5) 35%, rgba(255,255,255,0) 60%);"},dialogContent:{maxWidth:"23rem"},dialogContentText:{color:"black"}}),D=function(e){var t=M(),a=e.onClose,n=e.open;return h.a.createElement(y.a,{onClose:function(){return a(!1)},open:n},h.a.createElement(b.a,{classes:{root:t.dialogContent}},e.playerToBeKicked?h.a.createElement(E.a,{classes:{root:t.dialogContentText}},'"With great power comes great responsibility" \u2013 Willst du ',e.playerToBeKicked.name," wirklich aus dem Spiel werfen?"):null),h.a.createElement(P.a,null,h.a.createElement(O.a,{type:"button",onClick:function(){return a(!1)}},"Abbrechen"),h.a.createElement(O.a,{type:"button",color:"primary",onClick:function(){return a(!0)}},"Rauswerfen")))},T=function(e){var t=M(),a=Object(f.useState)(null),n=Object(v.a)(a,2),r=n[0],i=n[1],o=Object(f.useState)(!1),s=Object(v.a)(o,2),l=s[0],u=s[1],c=Object(f.useState)(null),d=Object(v.a)(c,2),m=d[0],p=d[1],g=new Map;e.allPlayers.forEach((function(e,t){e.isAdmin||g.set(t,e)}));var y=Object(F.j)(g);return h.a.createElement("div",{className:t.adminPanel},h.a.createElement(C.a,{className:t.menuButton,title:"Admin-Panel \xf6ffnen","aria-label":"Admin-Panel \xf6ffnen","aria-controls":"admin-panel","aria-haspopup":"true",onClick:function(e){i(e.currentTarget)}},h.a.createElement(S.a,{color:"primary"})),h.a.createElement(R.a,{id:"admin-panel",anchorEl:r,keepMounted:!0,open:Boolean(r),onClose:function(){i(null)}},y.map((function(e,t){return h.a.createElement(w.a,{key:"menu-item-delete-player-".concat(t),title:"".concat(e.name," aus dem Spiel werfen"),onClick:function(){return t=e,i(null),p(t),void u(!0);var t}},h.a.createElement(j.a,null,h.a.createElement(A.a,{color:"secondary"})),h.a.createElement(k.a,{primary:e.name}))}))),h.a.createElement(D,{open:l,playerToBeKicked:m,onClose:function(t){u(!1),t&&m&&e.kickPlayer(m.id)}}))},G=(a(219),a(63)),L=a(38),W=function(){function e(t,a){Object(o.a)(this,e),this.x=t,this.y=a,this.radius=3.5}return Object(s.a)(e,[{key:"draw",value:function(e){e.save(),e.translate(this.x,this.y),e.fillStyle="white",e.fillRect(0,0,this.radius,this.radius),e.restore()}}]),e}(),z=function(){function e(t,a){var n=this;Object(o.a)(this,e),this.letters=t,this.callbackWhenAnimationDone=a,this.canvas=void 0,this.ctx=void 0,this.currentPos=void 0,this.width=void 0,this.height=void 0,this.particlePositions=void 0,this.particles=void 0,this.tmpCanvas=void 0,this.tmpCtx=void 0,this.time=void 0,this.counter=0,this.myInterval=void 0,this.activeTheme=void 0,this.animate=function(){requestAnimationFrame(n.animate),n.ctx.fillStyle=n.activeTheme.animationBackgroundColor,n.ctx.fillRect(0,0,n.width,n.height),n.animateParticles()},this.canvas=document.querySelector("#letter-animation-canvas"),this.ctx=this.canvas.getContext("2d");var r=document.querySelector("main");this.activeTheme=L.a.find((function(e){return r.classList.contains(e.className)})),this.width=r.offsetWidth,this.height=r.offsetHeight,this.particlePositions=[],this.particles=[],this.tmpCanvas=document.createElement("canvas"),this.tmpCtx=this.tmpCanvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height,this.particlePositions=[],this.currentPos=0,this.time=""}return Object(s.a)(e,[{key:"init",value:function(){var e=this;this.myInterval=setInterval((function(){e.counter<e.letters.length&&(e.changeLetter(),e.getPixels(e.tmpCanvas,e.tmpCtx)),e.counter++,e.counter>e.letters.length+1&&(clearInterval(e.myInterval),e.callbackWhenAnimationDone())}),G.h),this.makeParticles(1e3),this.animate()}},{key:"changeLetter",value:function(){this.time=this.letters[this.currentPos],this.currentPos++,this.currentPos>=this.letters.length&&(this.currentPos=0)}},{key:"makeParticles",value:function(e){for(var t=0;t<=e;t++){var a=this.width/2+400*Math.random()-200,n=this.height/2+400*Math.random()-200;this.particles.push(new W(a,n))}}},{key:"getPixels",value:function(e,t){var a=this.time;e.width=window.innerWidth,e.height=window.innerHeight,t.fillStyle="red",t.font="italic bold 330px Noto Serif",t.fillText(a,e.width/2-t.measureText(a).width/2,e.height/2+100);var n=t.getImageData(0,0,e.width,e.height),r=new Uint32Array(n.data.buffer);this.particlePositions.length>0&&(this.particlePositions=[]);for(var i=0;i<e.height;i+=6)for(var o=0;o<e.width;o+=6)r[i*e.width+o]&&this.particlePositions.push({x:o,y:i})}},{key:"animateParticles",value:function(){for(var e,t,a=0,n=this.particles.length;a<n;a++)e=this.particles[a],t=this.particlePositions[a],this.particles.indexOf(e)===this.particlePositions.indexOf(t)&&(e.x+=.3*(t.x-e.x),e.y+=.3*(t.y-e.y),e.draw(this.ctx))}}]),e}(),V=function(e){var t=Object(i.a)(G.p).filter((function(t){return t!==e.letterToUnveil})),a=[].concat(Object(i.a)(Object(F.k)(G.g-1,t)),[e.letterToUnveil]);return Object(f.useEffect)((function(){new z(a,e.callbackWhenAnimationDone).init()})),h.a.createElement("canvas",{id:"letter-animation-canvas"})},B=a(77),K=(a(220),a(5)),U=a(290),q=a(268),_=a(291),H=a(292),J=a(280),Z=a(269),Q=a(235),X=a(224),Y=a.n(X),$=a(225),ee=a.n($),te=a(222),ae=a.n(te),ne=a(165),re=a.n(ne),ie=a(223),oe=a.n(ie),se=a(176),le=a.n(se),ue=a(221),ce=a.n(ue),de=Object(I.a)({centerContent:{display:"flex",justifyContent:"center"},chip:{height:"3rem",marginTop:"1rem",borderRadius:"5px",fontSize:"1.2rem",boxShadow:"0 2px 4px rgba(0,0,0,.501961)"}}),me=function(e){var t=de(),a=e.currentLetter,n=e.currentRound,r=e.numberOfRounds;return h.a.createElement("div",{className:t.centerContent},h.a.createElement(H.a,{color:"primary",icon:h.a.createElement(ce.a,null),label:"Runde ".concat(n," von ").concat(r,": \u201e").concat(a,"\u201c"),className:t.chip}))},pe=a(64),fe=Object(K.a)((function(e){return Object(U.a)({badge:{right:-3,top:"100%",border:"2px solid ".concat(e.palette.background.paper),padding:"0 4px"}})}))(q.a),he=function(e){var t=Object(f.useState)(e.playersThatFinishedEvaluation.has(e.playerInfo.id)),a=Object(v.a)(t,2),n=a[0],r=a[1],i=Object(f.useState)(!1),o=Object(v.a)(i,2),s=o[0],l=o[1],u=Object(f.useState)(""),c=Object(v.a)(u,2),d=c[0],m=c[1],p=e.allPlayers,g=e.currentRound,y=e.currentRoundEvaluation,b=e.gameConfig,E=e.playerInfo,P=e.playersThatFinishedEvaluation,O=e.gameRounds[g-1],R=b.letters[g-1],w=Object(F.j)(p),j=[];w.forEach((function(e){P.has(e.id)||j.push(e.name)}));var k=function(e){m(e),l(!0)},I=function(t,a){var r=w[a],i=y.get(r.id)[t],o=i.get(E.id),s=Object(F.l)(i,p),l=0===s.length?"Keine Ablehnungen":"Abgelehnt von "+s.map((function(e){return e.name})).join(", "),u=!!O.get(r.id)[t].text,c=h.a.createElement(_.a,{key:"slf-evaluation-tooltip-".concat(t,"-").concat(a),title:l},h.a.createElement(C.a,{className:"slf-evaluation-button",color:o?"default":"secondary",onClick:function(){return function(t,a,r){n?k("Du hast bereits die Bewertung der Runde best\xe4tigt!"):e.updateEvaluationOfPlayerInput({categoryIndex:t,evaluatedPlayerId:a,markedAsValid:!r})}(t,r.id,o)}},h.a.createElement(fe,{badgeContent:s.length,color:"secondary"},h.a.createElement(le.a,null)))),d=h.a.createElement(_.a,{key:"slf-evaluation-tooltip-".concat(t,"-").concat(a),title:"Automatisch abgelehnt"},h.a.createElement(le.a,{color:"secondary",className:"slf-auto-reject-icon"}));return h.a.createElement("div",{key:"slf-evaluation-button-wrapper-".concat(t,"-").concat(a),className:"slf-evaluation-button-wrapper"},u?c:d)},x=function(e,t){var a=b.categories[e],n=w[t],r=O.get(n.id)[e].text,i="https://www.ecosia.org/search?q=".concat(encodeURIComponent(a),"+").concat(encodeURIComponent(r));return h.a.createElement("a",{className:"slf-evaluation-search-link",href:i,target:"_blank",rel:"noopener noreferrer","aria-label":"Begriff nachschlagen"},h.a.createElement(_.a,{title:"Begriff nachschlagen",placement:"bottom"},h.a.createElement(ae.a,{color:"primary",fontSize:"small"})))},A=function(t,a){var r=w[a],i=O.get(r.id)[t];return h.a.createElement(_.a,{title:i.star?"Besonders kreativ? Nope!":"Als besonders kreativ markieren",placement:"bottom"},h.a.createElement(C.a,{className:"slf-mark-as-creative-button",color:"primary",size:"small",onClick:function(){return function(t,a,r){n?k("Du hast bereits die Bewertung der Runde best\xe4tigt!"):e.playerInfo.id===a?k("Nice try! Ob deine eigene Antwort sehr kreativ oder lustig ist, sollen die anderen beurteilen."):e.updateIsPlayerInputVeryCreativeStatus({categoryIndex:t,evaluatedPlayerId:a,markedAsCreative:!r})}(t,r.id,i.star)}},i.star?h.a.createElement(re.a,null):h.a.createElement(oe.a,null)))},N=function(e){var t=b.scoringOptions.creativeAnswersExtraPoints&&e.star?e.points+G.d:e.points;return h.a.createElement(H.a,{label:"+".concat(t),color:"primary"})};return h.a.createElement(h.a.Fragment,null,h.a.createElement(me,{currentLetter:R,currentRound:g,numberOfRounds:b.numberOfRounds}),h.a.createElement("form",{className:"app-form",noValidate:!0,autoComplete:"off"},b.categories.map((function(e,t){return h.a.createElement("div",{key:"slf-evaluation-for-category-no-"+t,className:"material-card-style"},h.a.createElement(pe.a,{showDivider:!1,text:e}),w.map((function(e,a){return function(e,t){var a=w[t],n=O.get(a.id)[e],r=!!n.text,i=n.valid,o=i?n.star?"very-creative-player-input":"":"invalid-player-input";return h.a.createElement("div",{key:"slf-evaluation-textfield-wrapper-".concat(e,"-").concat(t),className:"slf-evaluation-textfield-wrapper"},h.a.createElement(J.a,{key:"slf-textfield-category-no-"+e+"-player-"+t,value:n.text,variant:"outlined",fullWidth:!0,InputProps:{className:o,spellCheck:!1,startAdornment:h.a.createElement(Z.a,{position:"start"},a.name,":"),endAdornment:h.a.createElement(Z.a,{position:"end"},h.a.createElement("div",{className:"slf-evaluation-textfield-end-adornment"},r?x(e,t):null,i?A(e,t):null,i?N(n):null))}}),I(e,t))}(t,a)})))})),h.a.createElement("div",{className:"material-card-style"},"Best\xe4tigung ausstehend: ",h.a.createElement("span",{className:"bold-text"},j.join(", "))),h.a.createElement(C.a,{type:"button",className:"fixed-bottom-right-button",color:"secondary",title:"Best\xe4tigen","aria-label":"Best\xe4tigen",onClick:function(){n||(r(!0),e.sendEvaluationFinishedMessage())}},n?h.a.createElement(Y.a,null):h.a.createElement(ee.a,null))),h.a.createElement(Q.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:s,autoHideDuration:3e3,onClose:function(){return l(!1)},message:d}))},ge=a(227),ve=a.n(ge),ye=a(226),be=Object(I.a)((function(e){return Object(U.a)({countdown:{position:"fixed",right:"1.5rem",bottom:"1rem",backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText,padding:"0.5rem 1rem",fontSize:"1.5rem",boxShadow:"0 2px 4px rgba(0, 0, 0, .401961)",borderRadius:"5px"}})})),Ee=h.a.memo((function(e){var t=be();return h.a.createElement(ye.a,{date:Date.now()+1e3*e.duration,renderer:function(e){return h.a.createElement("div",{className:t.countdown},Object(ye.b)(e.minutes),":",Object(ye.b)(e.seconds))},onComplete:e.onComplete})})),Pe=function(e){var t=e.currentRound,a=e.gameConfig,n=e.gameRoundInputs,o=a.letters[t-1],s=h.a.createElement(C.a,{type:"button",className:"fixed-bottom-right-button",color:"secondary",title:"Abschicken","aria-label":"Abschicken",onClick:e.finishRoundOnUserAction},h.a.createElement(ve.a,null)),l=h.a.createElement(Ee,{duration:e.gameConfig.durationOfCountdown,onComplete:e.finishRoundOnCountdownComplete});return h.a.createElement(h.a.Fragment,null,h.a.createElement(me,{currentLetter:o,currentRound:t,numberOfRounds:a.numberOfRounds}),h.a.createElement("form",{className:"app-form",noValidate:!0,autoComplete:"off"},a.categories.map((function(t,a){return h.a.createElement("div",{key:"slf-input-for-category-no-"+a,className:"material-card-style"},h.a.createElement(pe.a,{showDivider:!1,text:t}),h.a.createElement(J.a,{value:n[a].text,onChange:function(t){return function(t,a){var o=Object(i.a)(n);o[a]=Object(r.a)({},o[a],{text:t.target.value}),e.updateCurrentRoundInputs(o)}(t,a)},variant:"outlined",fullWidth:!0,InputProps:{startAdornment:h.a.createElement(Z.a,{position:"start"},o,":"),spellCheck:!1}}))})),a.useCountdown?l:s))},Oe=(a(228),a(119)),Ce=a(230),Re=a.n(Ce);!function(e){e.currentRoundInputs="currentRoundInputs",e.dataForCurrentGame="dataForCurrentGame",e.evaluationFinished="evaluationFinished",e.evaluationOfPlayerInput="evaluationOfPlayerInput",e.isPlayerInputVeryCreative="isPlayerInputVeryCreative",e.kickPlayer="kickPlayer",e.requestGameData="requestGameData",e.roundFinished="roundFinished",e.startGame="startGame"}(n||(n={}));var we=function(){function e(t){Object(o.a)(this,e),this.payload=t}return Object(s.a)(e,[{key:"toPubNubMessage",value:function(){return{type:n.currentRoundInputs,payload:this.payload}}}]),e}(),je=function(){function e(t){Object(o.a)(this,e),this.payload=t}return Object(s.a)(e,[{key:"toPubNubMessage",value:function(){return{type:n.evaluationOfPlayerInput,payload:this.payload}}}]),e}(),ke=function(){function e(t){Object(o.a)(this,e),this.payload=t}return Object(s.a)(e,[{key:"toPubNubMessage",value:function(){return{type:n.isPlayerInputVeryCreative,payload:this.payload}}}]),e}(),Ie=function(){function e(t){Object(o.a)(this,e),this.payload=t}return Object(s.a)(e,[{key:"toPubNubMessage",value:function(){return{type:n.kickPlayer,payload:this.payload}}}]),e}(),xe=function(){function e(t){Object(o.a)(this,e),this.payload=t}return Object(s.a)(e,[{key:"toPubNubMessage",value:function(){return{type:n.dataForCurrentGame,payload:this.payload}}}]),e}(),Ae=a(289),Ne=a(175),Se=a.n(Ne),Fe=a(43),Me=a(229),De=a.n(Me),Te=function(e){var t=Object(f.useState)(!1),a=Object(v.a)(t,2),n=a[0],r=a[1],i=window.location.href,o=i.slice(0,i.length-5)+"/joingame?id="+e.gameId;return h.a.createElement(h.a.Fragment,null,h.a.createElement("p",{className:De.a.link_label},"Teile diesen Link mit Freunden:"),h.a.createElement(Ae.a,{name:"idInput",value:o,className:"app-form-input",disabled:!0,fullWidth:!0,endAdornment:h.a.createElement(Z.a,{position:"end"},h.a.createElement(C.a,{title:"Link kopieren","aria-label":"Link kopieren",onClick:function(){Object(Fe.d)(o),r(!0)}},h.a.createElement(Se.a,null)))}),h.a.createElement(Q.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:n,autoHideDuration:1500,onClose:function(){r(!1)},message:"Der Link wurde in Zwischenablage kopiert."}))},Ge=a(172),Le=a.n(Ge),We=Object(I.a)((function(e){return Object(U.a)({root:{display:"flex",flexWrap:"wrap",padding:e.spacing(.5)},chip:{margin:e.spacing(.5)}})})),ze=function(e){var t=We(),a=Object(F.j)(e.players);return h.a.createElement("div",{className:t.root},a.map((function(e,a){return h.a.createElement(H.a,{key:"player-name-".concat(a),icon:h.a.createElement(Le.a,null),color:e.isAdmin?"secondary":"primary",label:e.isAdmin?"".concat(e.name," (Admin)"):e.name,className:t.chip})})))},Ve=a(182),Be=function(e){var t=e.allPlayers,a=e.gameId,r=e.playerInfo,i=e.gameConfig,o=h.a.createElement("p",{className:"wait-for-start-animation"},"Warte auf Spielbeginn ",h.a.createElement("span",null,"."),h.a.createElement("span",null,"."),h.a.createElement("span",null,"."));return h.a.createElement(h.a.Fragment,null,h.a.createElement("div",{className:"material-card-style"},h.a.createElement(pe.a,{showDivider:!0,text:"Gleich geht's los..."}),h.a.createElement("div",{className:"players-wrapper"},h.a.createElement("h3",null,"Mitspieler (",e.allPlayers.size,"):"),h.a.createElement(ze,{players:e.allPlayers})),e.gameConfig?h.a.createElement(h.a.Fragment,null,h.a.createElement(Oe.a,null),h.a.createElement("h3",null,"Spieleinstellungen:"),h.a.createElement("p",null,h.a.createElement("span",{className:"bold-text"},"ID:")," ",e.gameId),h.a.createElement("p",null,h.a.createElement("span",{className:"bold-text"},"Runden:")," ",i.numberOfRounds),h.a.createElement("p",null,h.a.createElement("span",{className:"bold-text"},"Kategorien:")," ",i.categories.join(", ")),h.a.createElement("p",null,h.a.createElement("span",{className:"bold-text"},"Beenden der Runde durch:"),h.a.createElement("span",null," ",i.useCountdown?"Countdown (".concat(i.durationOfCountdown," Sekunden)"):"Spieler")),h.a.createElement(Ve.a,{rules:i.scoringOptions})):null,h.a.createElement(Oe.a,null),r.isAdmin?h.a.createElement("div",{className:"button-wrapper add-margin-top"},h.a.createElement(O.a,{color:"primary",variant:"contained",size:"large",startIcon:h.a.createElement(Re.a,null),disabled:t.size<G.l,onClick:function(){return e.sendMessage({type:n.startGame})}},"Starten")):o),r.isAdmin?h.a.createElement("div",{className:"material-card-style"},h.a.createElement(Te,{gameId:a})):null)},Ke=h.a.memo((function(e){var t=Object(p.b)(),a=function(){var a;a=e.playerInfo.isAdmin?{gameConfig:e.gameConfig,playerInfo:e.playerInfo}:{playerInfo:e.playerInfo},t.setState({channels:[e.gameChannel],state:a})},n=function(){t.hereNow({channels:[e.gameChannel],includeUUIDs:!0,includeState:!0},(function(t,a){if(console.log("PubNub hereNow",a),e.isRejoiningGame&&a.totalOccupancy<=1)e.navigateToDashboard();else{var n=a.channels[e.gameChannel];if(n){var r=[];n.occupants.forEach((function(e){var t=e.state;t&&t.playerInfo&&r.push(t)})),e.addPlayers.apply(e,r)}}}))};return Object(f.useEffect)((function(){var r={message:function(t){console.log("PubNub message event",t),t.message.type&&e.processPubNubMessage(t)},presence:function(t){if(console.log("PubNub presence event",t),"state-change"===t.action){var a=t.state;a.playerInfo.id!==e.playerInfo.id&&e.addPlayers(a)}},status:function(r){console.log("PubNub status event",r),"PNConnectedCategory"===r.category&&(console.log("Player is connected to PubNub game channel"),t.history({channel:e.gameChannel,count:10},(function(t,r){!e.isRejoiningGame&&r.messages.length>0?e.navigateToDashboard():e.isRejoiningGame||(a(),n(),setTimeout(n,3e3))})))}};return t.addListener(r),t.subscribe({channels:[e.gameChannel],withPresence:!0}),function(){t.removeListener(r),t.unsubscribeAll()}})),null})),Ue=a(231),qe={publishKey:Ue.publishKey,subscribeKey:Ue.subscribeKey,uuid:void 0,ssl:!0},_e=a(13),He=a(23),Je=function(e,t,a){if(e.id===a)return!1;if(e.isAdmin)return!0;var n=t.get(a);if(n&&n.isAdmin){var r=Object(c.cloneDeep)(t);return r.delete(a),Array.from(r).map((function(e){return e[1]})).sort((function(e,t){return e.id<t.id?-1:e.id>t.id?1:0}))[0].id===e.id}return!1},Ze=function(e,t){var a=new Map;e.forEach((function(e,n){a.set(n,e.map((function(e){var a=[];return t.forEach((function(t){return a.push(e.get(t.id))})),a})))}));var n=[];return t.forEach((function(e){return n.push(a.get(e.id))})),n},Qe=function(e,t){var a=new Map;return t.forEach((function(n,r){var i=e[r].map((function(e){var a=new Map;return t.forEach((function(t,n){return a.set(t.id,e[n])})),a}));a.set(n.id,i)})),a},Xe=function(e,t){var a=[];return t.forEach((function(t){var n=e.get(t.id);a.push(n.map((function(e){return e.star})))})),a},Ye=function(e){for(var t=[],a=1;a<=e;a++){var n=Object(He.e)(a);n&&t.push(n)}return t},$e=function(e,t,a,n){n.forEach((function(e,n){var r=t.get(n);e.forEach((function(e,t){e.valid&&(e.valid=Object(F.i)(r[t])<a)}))})),Object(F.d)(e,n)},et=function(e,t,a){t.forEach((function(t,n){var r=e[n];a.get(t.id).forEach((function(e,t){return e.star=r[t]}))}))},tt=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(o.a)(this,a);for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];return(e=t.call.apply(t,[this].concat(s))).state={allPlayers:new Map,currentPhase:G.f.waitingToStart,currentRound:1,currentRoundEvaluation:new Map,currentRoundInputs:[],gameConfig:null,gameRounds:[],playersThatFinishedEvaluation:new Map,showLetterAnimation:!1,showLoadingScreen:!0},e.pubNubClient=void 0,e.sendMessage=function(t){e.pubNubClient.publish({channel:e.props.gameId,message:t,storeInHistory:!0,ttl:1},(function(e,t){return console.log("PubNub Publish:",e,t)}))},e.createCurrentPhaseElement=function(){switch(e.state.currentPhase){case G.f.waitingToStart:return h.a.createElement(Be,{allPlayers:e.state.allPlayers,gameConfig:e.state.gameConfig,gameId:e.props.gameId,playerInfo:e.props.playerInfo,sendMessage:e.sendMessage});case G.f.fillOutTextfields:return h.a.createElement(Pe,{currentRound:e.state.currentRound,gameConfig:e.state.gameConfig,gameRoundInputs:e.state.currentRoundInputs,updateCurrentRoundInputs:e.updateCurrentRoundInputs,finishRoundOnCountdownComplete:e.finishRoundOnCountdownComplete,finishRoundOnUserAction:e.finishRoundOnUserAction});case G.f.evaluateRound:return h.a.createElement(he,{allPlayers:e.state.allPlayers,currentRound:e.state.currentRound,currentRoundEvaluation:e.state.currentRoundEvaluation,gameConfig:e.state.gameConfig,gameRounds:e.state.gameRounds,playerInfo:e.props.playerInfo,playersThatFinishedEvaluation:e.state.playersThatFinishedEvaluation,sendEvaluationFinishedMessage:e.sendEvaluationFinishedMessage,updateEvaluationOfPlayerInput:e.updateEvaluationOfPlayerInput,updateIsPlayerInputVeryCreativeStatus:e.updateIsPlayerInputVeryCreativeStatus});default:return null}},e.callbackWhenAnimationDone=function(){e.setState({showLetterAnimation:!1})},e.navigateToDashboard=function(){Object(He.f)(),e.props.onResetAppState(),e.props.history.push("/")},e.addPlayers=function(){if(e.state.currentPhase===G.f.waitingToStart){for(var t=null,a=Object(c.cloneDeep)(e.state.allPlayers),n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r.forEach((function(n){a.set(n.playerInfo.id,n.playerInfo),n.gameConfig&&!e.state.gameConfig&&(t=n.gameConfig)})),t?(Object(He.i)(t),e.setState({allPlayers:a,gameConfig:t,showLoadingScreen:!1})):e.setState({allPlayers:a})}},e.processPubNubMessage=function(t){var a=t.message;switch(a.type){case n.startGame:e.startGame();break;case n.roundFinished:e.stopRoundAndSendInputs();break;case n.currentRoundInputs:e.addPlayerInputForFinishedRound(t.publisher,a.payload);break;case n.evaluationOfPlayerInput:e.processEvaluationOfPlayerInput(t.publisher,a.payload);break;case n.isPlayerInputVeryCreative:e.processIsPlayerInputVeryCreativeStatus(a.payload);break;case n.evaluationFinished:e.countPlayerAsEvaluationFinished(t.publisher);break;case n.kickPlayer:e.removePlayerFromGame(a.payload);break;case n.requestGameData:Je(e.props.playerInfo,e.state.allPlayers,t.publisher)&&(e.state.allPlayers.has(t.publisher)?e.sendDataForCurrentGame(t.publisher):e.sendKickPlayerMessage(t.publisher));break;case n.dataForCurrentGame:e.restoreDataForCurrentGame(a.payload)}},e.startGame=function(){var t=e.state.gameConfig,a=Object(F.e)(e.state.allPlayers,t.categories);e.setState({currentPhase:G.f.fillOutTextfields,currentRoundEvaluation:a,currentRoundInputs:Object(F.g)(t.categories.length),showLetterAnimation:!0})},e.updateCurrentRoundInputs=function(t){e.setState({currentRoundInputs:t})},e.finishRoundOnCountdownComplete=function(){e.setState({showLoadingScreen:!0}),e.props.playerInfo.isAdmin&&e.sendMessage({type:n.roundFinished})},e.finishRoundOnUserAction=function(){e.setState({showLoadingScreen:!0}),e.sendMessage({type:n.roundFinished})},e.stopRoundAndSendInputs=function(){var t=[].concat(Object(i.a)(e.state.gameRounds),[new Map]);e.setState({gameRounds:t,showLoadingScreen:!0});var a=new we(Object(F.m)(e.state.currentRoundInputs));e.sendMessage(a.toPubNubMessage())},e.addPlayerInputForFinishedRound=function(t,a){var n=Object(c.cloneDeep)(e.state.gameRounds),r=e.state.currentRound-1;n[r].set(t,a),n[r].size===e.state.allPlayers.size?(Object(F.d)(e.state.gameConfig.scoringOptions,n[r]),Object(He.k)(e.state.currentRound,n[r]),e.setState({currentPhase:G.f.evaluateRound,gameRounds:n,showLoadingScreen:!1})):e.setState({gameRounds:n})},e.updateEvaluationOfPlayerInput=function(t){var a=new je(t);e.sendMessage(a.toPubNubMessage())},e.processEvaluationOfPlayerInput=function(t,a){if(e.state.allPlayers.has(t)){var n=a.categoryIndex,r=a.evaluatedPlayerId,i=a.markedAsValid,o=Object(c.cloneDeep)(e.state.currentRoundEvaluation),s=o.get(r);s[n].set(t,i);var l=Object(c.cloneDeep)(e.state.gameRounds),u=Object(F.i)(s[n])<Object(F.h)(e.state.allPlayers.size),d=l[e.state.currentRound-1];d.get(r)[n].valid=u,Object(F.c)(e.state.gameConfig.scoringOptions,d,n),e.setState({currentRoundEvaluation:o,gameRounds:l})}},e.updateIsPlayerInputVeryCreativeStatus=function(t){var a=new ke(t);e.sendMessage(a.toPubNubMessage())},e.processIsPlayerInputVeryCreativeStatus=function(t){var a=t.categoryIndex,n=t.evaluatedPlayerId,r=t.markedAsCreative,i=Object(c.cloneDeep)(e.state.gameRounds);i[e.state.currentRound-1].get(n)[a].star=r,e.setState({gameRounds:i})},e.sendEvaluationFinishedMessage=function(){return e.sendMessage({type:n.evaluationFinished})},e.countPlayerAsEvaluationFinished=function(t){var a=Object(c.cloneDeep)(e.state.playersThatFinishedEvaluation);a.set(t,!0),a.size===e.state.allPlayers.size?e.processEvaluationsAndStartNextRoundOrFinishGame():e.setState({playersThatFinishedEvaluation:a})},e.processEvaluationsAndStartNextRoundOrFinishGame=function(){var t=e.state,a=t.allPlayers,n=t.currentRound,r=e.state.gameConfig,i=Object(c.cloneDeep)(e.state.gameRounds);Object(F.a)(r.scoringOptions,i[n-1]),n===r.numberOfRounds?(Object(He.f)(),e.props.onSetDataOfFinishedGame({allPlayers:a,gameConfig:r,gameRounds:i}),e.props.history.push("/results")):(Object(He.k)(e.state.currentRound,i[n-1]),e.setState({currentPhase:G.f.fillOutTextfields,currentRoundEvaluation:Object(F.e)(a,r.categories),currentRoundInputs:Object(F.g)(r.categories.length),currentRound:n+1,gameRounds:i,playersThatFinishedEvaluation:new Map,showLetterAnimation:!0}))},e.sendKickPlayerMessage=function(t){var a=new Ie(t);e.sendMessage(a.toPubNubMessage())},e.removePlayerFromGame=function(t){if(e.props.playerInfo.id===t)return Object(He.f)(),e.props.onResetAppState(),void e.props.history.push("/");if(e.state.allPlayers.has(t)){var a=Object(c.cloneDeep)(e.state.allPlayers);a.delete(t);var n=Object(c.cloneDeep)(e.state.currentRoundEvaluation);n.delete(t);var r=Object(c.cloneDeep)(e.state.gameRounds);r.forEach((function(e){return e.delete(t)}));var i=Object(c.cloneDeep)(e.state.playersThatFinishedEvaluation);i.delete(t),e.setState({allPlayers:a,currentRoundEvaluation:n,gameRounds:r,playersThatFinishedEvaluation:i}),e.state.currentPhase===G.f.evaluateRound&&i.size===a.size&&e.processEvaluationsAndStartNextRoundOrFinishGame()}},e.sendDataForCurrentGame=function(t){var a=e.state,n=a.allPlayers,r=a.currentPhase,i=a.currentRound,o=a.currentRoundEvaluation,s=a.gameRounds,l=Object(F.j)(n),u=r===G.f.evaluateRound?Ze(o,l):[],c=r===G.f.evaluateRound?Xe(s[i-1],l):[],d=new xe({compressedGameRoundEvaluation:u,compressedMarkedAsCreativeFlags:c,currentPhase:r,currentRound:i,playersThatFinishedEvaluation:Object(Fe.c)(e.state.playersThatFinishedEvaluation),requestingPlayerId:t,sortedPlayers:l});e.sendMessage(d.toPubNubMessage())},e.restoreDataForCurrentGame=function(t){if(e.props.playerInfo.id===t.requestingPlayerId){var a=Object(He.c)(),n=t.currentPhase===G.f.evaluateRound?t.currentRound:t.currentRound-1,r=Ye(n);if(a&&r.length===n){var i,o=new Map;if(t.sortedPlayers.forEach((function(e){return o.set(e.id,e)})),t.currentPhase===G.f.evaluateRound){var s=r[t.currentRound-1];i=Qe(t.compressedGameRoundEvaluation,t.sortedPlayers),$e(a.scoringOptions,i,Object(F.h)(o.size),s),et(t.compressedMarkedAsCreativeFlags,t.sortedPlayers,s)}else i=Object(F.e)(o,a.categories);e.setState({allPlayers:o,currentPhase:t.currentPhase,currentRound:t.currentRound,currentRoundEvaluation:i,currentRoundInputs:Object(F.g)(a.categories.length),gameConfig:a,gameRounds:r,playersThatFinishedEvaluation:Object(Fe.a)(t.playersThatFinishedEvaluation),showLoadingScreen:!1})}else console.log("Error: Can't restore game session because data is missing in local storage!"),e.navigateToDashboard()}},e}return Object(s.a)(a,[{key:"render",value:function(){if(null===this.props.gameId||null===this.props.playerInfo)return null;this.pubNubClient||(this.pubNubClient=new m.a(Object(r.a)({},qe,{uuid:this.props.playerInfo.id})));var e=h.a.createElement(V,{letterToUnveil:this.state.gameConfig?this.state.gameConfig.letters[this.state.currentRound-1]:"",callbackWhenAnimationDone:this.callbackWhenAnimationDone}),t=h.a.createElement(T,{allPlayers:this.state.allPlayers,kickPlayer:this.sendKickPlayerMessage}),a=this.state,n=a.showLetterAnimation,i=a.showLoadingScreen;return h.a.createElement(p.a,{client:this.pubNubClient},h.a.createElement(Ke,{gameChannel:this.props.gameId,gameConfig:this.props.gameConfig,isRejoiningGame:this.props.isRejoiningGame,playerInfo:this.props.playerInfo,navigateToDashboard:this.navigateToDashboard,addPlayers:this.addPlayers,processPubNubMessage:this.processPubNubMessage}),n?e:null,i?h.a.createElement(B.a,null):null,i||n?null:h.a.createElement("div",{className:"main-content-wrapper"},this.createCurrentPhaseElement()),this.props.playerInfo.isAdmin&&this.state.allPlayers.size>1?t:null)}},{key:"componentDidMount",value:function(){var e=this.props,t=e.gameConfig,a=e.gameId,r=e.isRejoiningGame,i=e.playerInfo;if(null!==a&&null!==i)if(r)this.sendMessage({type:n.requestGameData});else{var o=new Map;o.set(i.id,i),i.isAdmin?(Object(He.i)(t),this.setState({allPlayers:o,gameConfig:t,showLoadingScreen:!1})):this.setState({allPlayers:o})}else this.props.history.push("/")}}]),a}(f.Component);t.default=Object(g.b)((function(e){return{gameConfig:e.gameConfig,gameId:e.gameId,isRejoiningGame:e.isRejoiningGame,playerInfo:e.playerInfo}}),(function(e){return{onSetDataOfFinishedGame:function(t){return e(Object(_e.j)(t))},onResetAppState:function(){return e(Object(_e.g)())}}}))(tt)}}]);
//# sourceMappingURL=9.6704ef54.chunk.js.map